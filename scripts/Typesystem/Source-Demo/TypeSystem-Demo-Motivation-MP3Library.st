Object subclass: #MP3LibraryDirect	instanceVariableNames: 'genreDictionary totalDuration'	classVariableNames: 'library'	poolDictionaries: ''	category: 'TypeSystem-Demo-Motivation-MP3Library'!!MP3LibraryDirect commentStamp: 'OzC 8/26/2012 00:45' prior: 0!The library for the untyped code. To test this please execute this snippet:|authors1 authors2|MP3LibraryDirect library: MP3TagV1.MP3LibraryDirect new add: 'Test.mp3'; totalDurationString.authors1:=MP3LibraryDirect new add: 'Test.mp3'; getGenreList: #Rock.MP3LibraryDirect library: MP3TagV2.MP3LibraryDirect new add: 'Test.mp3'; totalDurationString.authors2 := MP3LibraryDirect new add: 'Test.mp3'; getGenreList: #Rock.self assert: (authors1 size = authors2 size) "Oops something goes wrong in the update. What happens?"!!MP3LibraryDirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 21:39'!add: aFile	|file|	library ifNil: [self error: 'Library has not been set'].	self traceCr: ('Using ', library name).	file := library new file: aFile.	totalDuration := file duration + totalDuration.	(genreDictionary at: file genre ifAbsentPut: [OrderedCollection new]) add: file author.! !!MP3LibraryDirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 21:46'!getGenreList: aSymbol	^genreDictionary at: aSymbol ifAbsent: [#()] .! !!MP3LibraryDirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 21:47'!totalDurationString	^(totalDuration // 3600) asString , ' hours, ', ((totalDuration \\ 3600) // 60) asString, ' minutes and ', (totalDuration \\ 60) asString, ' seconds'.! !!MP3LibraryDirect methodsFor: 'initialize-release' stamp: 'GradualtalkTeam 8/25/2012 21:33'!initialize	|list|	genreDictionary := IdentityDictionary new.	list := OrderedCollection withAll: {'U2'. 'The Beach Boys'}.	genreDictionary at: #Rock put: list.	genreDictionary at: #Jazz put: {'Greetje Kauffeld' . 'Amapola Cabase' . 'Milly Scott'}.	genreDictionary at: #Pop put: {}.	totalDuration := (16*60*60) + (40*60) + 21	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MP3LibraryDirect class	instanceVariableNames: ''!!MP3LibraryDirect class methodsFor: 'as yet unclassified' stamp: 'GradualtalkTeam 8/25/2012 21:34'!library: aClass	library := aClass! !Object subclass: #MP3TagInterface	uses: TTyped	instanceVariableNames: '(String)file (?)delegate'	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-Demo-Motivation-MP3Library'!!MP3TagInterface commentStamp: 'OzC 8/26/2012 00:44' prior: 0!The typed interface for the Typed library: MP3LibraryIndirect !!MP3TagInterface methodsFor: 'accessing' stamp: 'GradualtalkTeam 8/25/2012 21:04'!(String) author	^delegate author! !!MP3TagInterface methodsFor: 'accessing' stamp: 'GradualtalkTeam 8/25/2012 21:06'!(?) delegate	^ delegate! !!MP3TagInterface methodsFor: 'accessing' stamp: 'GradualtalkTeam 8/25/2012 21:06'!(Self) delegate: (?)anObject	delegate := anObject! !!MP3TagInterface methodsFor: 'accessing' stamp: 'OzC 8/25/2012 23:42'!(Integer) duration	^delegate duration	"^(delegate duration asNanoSeconds) // (10 raisedTo: 9) "            "fix it"! !!MP3TagInterface methodsFor: 'accessing' stamp: 'GradualtalkTeam 8/25/2012 21:03'!(String) file	^ delegate file! !!MP3TagInterface methodsFor: 'accessing' stamp: 'GradualtalkTeam 8/25/2012 21:03'!(Self) file: (String)anObject	delegate file: anObject! !!MP3TagInterface methodsFor: 'accessing' stamp: 'OzC 8/25/2012 23:42'!(Symbol) genre	^delegate genre	"^delegate genre asSymbol"    "fix it"! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MP3TagInterface class	uses: TTyped classTrait	instanceVariableNames: ''!!MP3TagInterface class methodsFor: 'as yet unclassified' stamp: 'GradualtalkTeam 8/25/2012 21:07'!(Self instance) delegateFor: (Class)aClass	^self new delegate: aClass new.! !Object subclass: #MP3LibraryIndirect	instanceVariableNames: 'genreDictionary totalDuration'	classVariableNames: 'library'	poolDictionaries: ''	category: 'TypeSystem-Demo-Motivation-MP3Library'!!MP3LibraryIndirect commentStamp: 'OzC 8/26/2012 00:44' prior: 0!The library for the typed code. To test this please execute by separated this two snippets:MP3LibraryIndirect library: MP3TagV1.MP3LibraryIndirect new add: 'Test.mp3'; totalDurationString.MP3LibraryIndirect new add: 'Test.mp3'; getGenreList: #Rock."----------- Upgrade point  ---------"MP3LibraryIndirect library: MP3TagV2.MP3LibraryIndirect new add: 'Test.mp3'; totalDurationString.MP3LibraryIndirect new add: 'Test.mp3'; getGenreList: #Rock. "Oops something goes wrong in the upgrade. What happens? Gradualtalk points to the source of errors (2). Fix them and all will be fine"!!MP3LibraryIndirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 22:00'!add: aFile	|file|	library ifNil: [self error: 'Library has not been set'].	self traceCr: ('Using ', library name).	file := (MP3TagInterface delegateFor: library) file: aFile.	totalDuration := file duration + totalDuration.	(genreDictionary at: file genre ifAbsentPut: [OrderedCollection new]) add: file author.! !!MP3LibraryIndirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 21:59'!getGenreList: aSymbol	^genreDictionary at: aSymbol ifAbsent: [#()] .! !!MP3LibraryIndirect methodsFor: 'mp3' stamp: 'GradualtalkTeam 8/25/2012 21:59'!totalDurationString	^(totalDuration // 3600) asString , ' hours, ', ((totalDuration \\ 3600) // 60) asString, ' minutes and ', (totalDuration \\ 60) asString, ' seconds'.! !!MP3LibraryIndirect methodsFor: 'initialize-release' stamp: 'GradualtalkTeam 8/25/2012 21:59'!initialize	|list|	genreDictionary := IdentityDictionary new.	list := OrderedCollection withAll: {'U2'. 'The Beach Boys'}.	genreDictionary at: #Rock put: list.	genreDictionary at: #Jazz put: {'Greetje Kauffeld' . 'Amapola Cabase' . 'Milly Scott'}.	genreDictionary at: #Pop put: {}.	totalDuration := (16*60*60) + (40*60) + 21	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MP3LibraryIndirect class	instanceVariableNames: ''!!MP3LibraryIndirect class methodsFor: 'as yet unclassified' stamp: 'GradualtalkTeam 8/25/2012 21:59'!library: aClass	library := aClass! !