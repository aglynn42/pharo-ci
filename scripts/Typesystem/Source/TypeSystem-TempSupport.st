PPCompositeParser subclass: #PPTypesGrammar	instanceVariableNames: 'type namedIdentifier parenType parametricIdentifier namedType parametricType groundType dynType advancedGroundType argumentType genericDeclaration genericElements genericElement smalltalkIdentifier unary binary keyword keywordToken unaryToken binaryToken selector methodSignature'	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:55'!binary	^ (PPPredicateObjectParser anyOf: '!!%&*+,-/<=>?@\|~') plus! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:55'!binaryToken	^ binary smalltalkToken! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:57'!keyword	^ (smalltalkIdentifier , $: asParser) plus! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:57'!keywordToken	^ keyword smalltalkToken! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 17:34'!namedIdentifier	^ (#uppercase asParser , #word asParser star) smalltalkToken! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 17:36'!parametricIdentifier	^ (#lowercase asParser , #word asParser star) smalltalkToken! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:58'!selector	^ keywordToken / unaryToken / binaryToken! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:51'!smalltalkIdentifier	^ Scanner allowUnderscoreAssignment		ifTrue: [ #letter asParser , #word asParser star ]		ifFalse: [			(PPPredicateObjectParser				on: [ :each | each isLetter or: [ each = $_ ] ]				message: 'letter expected') ,			(PPPredicateObjectParser				on: [ :each | each isAlphaNumeric or: [ each = $_ ] ]				message: 'letter or digit expected') star ]! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:54'!unary	^ smalltalkIdentifier , $: asParser not! !!PPTypesGrammar methodsFor: 'tokens' stamp: 'EstebanAllende 10/18/2012 19:54'!unaryToken	^ unary smalltalkToken! !!PPTypesGrammar methodsFor: 'accessing' stamp: 'EstebanAllende 10/18/2012 17:42'!start	^type end! !!PPTypesGrammar methodsFor: 'grammar - structural type' stamp: 'EstebanAllende 10/18/2012 19:58'!methodSignature	^selector, type! !!PPTypesGrammar methodsFor: 'grammar - structural type' stamp: 'EstebanAllende 10/18/2012 20:00'!methodSignatures	^methodSignature, ($. asParser smalltalkToken, methodSignature) star! !!PPTypesGrammar methodsFor: 'grammar - structural type' stamp: 'EstebanAllende 10/18/2012 20:03'!structuralType	^advancedGroundType, ${ asParser smalltalkToken, methodSignature, $} asParser smalltalkToken! !!PPTypesGrammar methodsFor: 'grammar - lambda type' stamp: 'EstebanAllende 10/18/2012 18:18'!argumentType	^advancedGroundType! !!PPTypesGrammar methodsFor: 'grammar - lambda type' stamp: 'EstebanAllende 10/18/2012 18:20'!lambdaType	^argumentType star, '->' asParser smalltalkToken, advancedGroundType! !!PPTypesGrammar methodsFor: 'grammar - generics' stamp: 'EstebanAllende 10/18/2012 18:23'!genericDeclaration	^$< asParser smalltalkToken, genericElements, $> asParser smalltalkToken! !!PPTypesGrammar methodsFor: 'grammar - generics' stamp: 'EstebanAllende 10/18/2012 18:25'!genericElement	^type! !!PPTypesGrammar methodsFor: 'grammar - generics' stamp: 'EstebanAllende 10/18/2012 18:24'!genericElements	^genericElement, ($, asParser smalltalkToken, genericElement) star! !!PPTypesGrammar methodsFor: 'grammar - composite types' stamp: 'EstebanAllende 10/18/2012 18:21'!advancedGroundType	^groundType, ('class' asParser / 'instance' asParser) smalltalkToken optional, genericDeclaration optional! !!PPTypesGrammar methodsFor: 'grammar - ground types' stamp: 'EstebanAllende 10/18/2012 17:44'!dynType	^ $? asParser smalltalkToken! !!PPTypesGrammar methodsFor: 'grammar - ground types' stamp: 'EstebanAllende 10/18/2012 17:44'!groundType	^ namedType / parametricType / dynType / parenType! !!PPTypesGrammar methodsFor: 'grammar - ground types' stamp: 'EstebanAllende 10/18/2012 17:39'!namedType	^ namedIdentifier! !!PPTypesGrammar methodsFor: 'grammar - ground types' stamp: 'EstebanAllende 10/18/2012 17:39'!parametricType	^ parametricIdentifier! !!PPTypesGrammar methodsFor: 'grammar - types' stamp: 'EstebanAllende 10/18/2012 17:32'!parenType	^ $( asParser smalltalkToken, type, $) asParser smalltalkToken! !!PPTypesGrammar methodsFor: 'grammar - types' stamp: 'EstebanAllende 10/18/2012 17:42'!type	^groundType! !PPBaseSmalltalkGrammar subclass: #PPTypeGrammar	instanceVariableNames: 'selfType dynType nominalClassType nominalType basicType methodSignatures unaryType selector parenType methodSignature nominalIdentifier type multipleKeywordToken lambdaType complexType lambdaSpecialToken generics genericDeclaration compositeType parametricIdentifier parametricType'	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!!PPTypeGrammar commentStamp: 'EstebanAllende 10/1/2012 15:16' prior: 0!A PPTypeGrammar is the grammar for type declaration.!!PPTypeGrammar methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/5/2011 00:26'!complexType	^ basicType optional , ${ asParser smalltalkToken , methodSignatures , $} asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/5/2011 00:35'!lambdaType	^ unaryType star , ('->' asParser / lambdaSpecialToken) smalltalkToken , unaryType! !!PPTypeGrammar methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/5/2011 00:27'!methodSignature	^ selector , parenType! !!PPTypeGrammar methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/16/2011 17:02'!methodSignatures	^ ((methodSignature , $. asParser smalltalkToken) star , methodSignature) ==> [:nodes| (nodes first collect: [:each|each first]) asOrderedCollection addLast: nodes second; yourself]! !!PPTypeGrammar methodsFor: 'grammar-generics'!genericDeclaration	^ $< asParser smalltalkToken, generics, $> asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'grammar-generics' stamp: 'EstebanAllende 3/20/2012 16:29'!generics	^ ((type , $, asParser smalltalkToken) star , type) ==> [:nodes| (nodes first collect: [:each|each first]) asOrderedCollection addLast: nodes second; yourself]! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 10/5/2012 12:20'!basicType	^ (selfType / dynType / nominalClassType / nominalType / parametricType), genericDeclaration optional! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/5/2011 00:26'!dynType	^ $? asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/15/2011 19:04'!nominalClassType	^ (nominalIdentifier , 'class' asParser) smalltalkToken ! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/5/2011 00:29'!nominalType	^ nominalIdentifier! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 10/5/2012 12:22'!parametricType	^ parametricIdentifier, ('<:' asParser, type) optional! !!PPTypeGrammar methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 3/27/2012 17:31'!selfType	^ 'Self' asParser smalltalkToken, ('class' asParser / 'instance' asParser) smalltalkToken! !!PPTypeGrammar methodsFor: 'grammar-types'!compositeType	^ lambdaType / complexType / basicType! !!PPTypeGrammar methodsFor: 'grammar-types' stamp: 'EstebanAllende 12/5/2011 00:29'!parenType	^ $( asParser smalltalkToken , type , $) asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'grammar-types' stamp: 'EstebanAllende 3/28/2012 15:11'!type	^ compositeType , ($| asParser smalltalkToken, compositeType) star! !!PPTypeGrammar methodsFor: 'grammar-types' stamp: 'EstebanAllende 12/5/2011 00:31'!unaryType	^ basicType / parenType! !!PPTypeGrammar methodsFor: 'token' stamp: 'EstebanAllende 12/5/2011 00:35'!lambdaSpecialToken	^ (Unicode charFromUnicode: 8594) asParser! !!PPTypeGrammar methodsFor: 'token' stamp: 'EstebanAllende 12/5/2011 00:28'!multipleKeywordToken	^keywordToken plus ==> [:tokens| PPSpecialSmalltalkToken on: tokens "PPSmalltalkToken on: (token inject: '' into: [:res :each| res, each value trimBoth])"]! !!PPTypeGrammar methodsFor: 'token' stamp: 'EstebanAllende 12/5/2011 00:29'!nominalIdentifier	^ (#uppercase asParser , #word asParser star) smalltalkToken! !!PPTypeGrammar methodsFor: 'token' stamp: 'EstebanAllende 10/5/2012 11:51'!parametricIdentifier	^ (#lowercase asParser , #word asParser star) smalltalkToken! !!PPTypeGrammar methodsFor: 'token' stamp: 'EstebanAllende 12/5/2011 00:30'!selector	^ multipleKeywordToken / unaryToken / binaryToken! !PPTypeGrammar subclass: #PPTypeParser	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!!PPTypeParser commentStamp: 'EstebanAllende 10/1/2012 15:17' prior: 0!A PPTypeParser is the parser of type declarations.!!PPTypeParser methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/12/2011 12:24'!complexType	^ super complexType		==> [:nodes | StructuralType new base: (nodes first ifNil: [Object asType]);				 methods: nodes third]! !!PPTypeParser methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/5/2011 11:48'!lambdaType	^ super lambdaType		==> [:nodes | 			| ltype |			ltype := LambdaType new.			ltype params: nodes first.			ltype return: nodes last.]! !!PPTypeParser methodsFor: 'grammar-composite types' stamp: 'EstebanAllende 12/12/2011 12:28'!methodSignature	^ super methodSignature		==> [:nodes | MethodSignature new selector: (nodes first) value asSymbol; signature: nodes last]! !!PPTypeParser methodsFor: 'grammar-generics' stamp: 'EstebanAllende 3/20/2012 16:37'!genericDeclaration	^ super genericDeclaration ==>[:nodes| nodes second]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 3/20/2012 17:58'!basicType	^super basicType ==> [:nodes|nodes first classParametrics: nodes second]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/5/2011 11:47'!dynType	^ super dynType		==> [:nodes | DynType explicitInstance]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/5/2011 11:38'!nominalClassType	^ super nominalClassType		==> [:token | NominalType named: token value]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 7/16/2012 02:16'!nominalType	^ super nominalType		==> [:token | UnlinkedType new name: token value asSymbol]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 10/5/2012 12:26'!parametricType	"^ parametricIdentifier, ('<:' asParser, type) optional"	^ super parametricType		==> [:nodes | 				|res|				res := ParametricType new.				res kind: #unknown.				res name: nodes first value asSymbol.				nodes second ifNotNil: [res upperBound: nodes second second].				res			  ]! !!PPTypeParser methodsFor: 'grammar-ground types' stamp: 'EstebanAllende 12/5/2011 11:40'!selfType	^ super selfType		==> [:token | SelfType new kind: (token second ifNil: [#normal] ifNotNil: [token second value asSymbol])]! !!PPTypeParser methodsFor: 'grammar-types' stamp: 'EstebanAllende 12/12/2011 12:28'!parenType	^super parenType ==>[:nodes| nodes second]! !!PPTypeParser methodsFor: 'grammar-types' stamp: 'EstebanAllende 3/28/2012 15:18'!type	^super type ==>[:nodes| (nodes second size = 0) 							ifTrue:[nodes first]							ifFalse:[|col|								col := (nodes second collect: [:each| each second]) asOrderedCollection.								col addFirst: nodes first.								UnionType new union: col							].]! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!PPTypeParser class	instanceVariableNames: ''!!PPTypeParser class methodsFor: 'class initialization' stamp: 'EstebanAllende 12/16/2011 17:04'!initialize	TypeConfiguration uniqueInstance bootstrap ifFalse: [^self].	PPTypedSmalltalkGrammar typeGrammar: self new type.	PPTypedSmalltalkParser typeGrammar: self new type.	PPTypedSmalltalkParser typeParser: self new type.! !PPTypeParser initialize!